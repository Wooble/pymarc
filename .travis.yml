language: python

matrix:
  include:
    - python: "2.7"
    - python: "pypy"
    - python: "pypy3"
    - python: "3.3"
      dist: "trusty"
    - python: "3.4"
    - python: "3.5"
    - python: "3.6"
    - python: "3.7"
    - python: "3.8"

script:
  - python setup.py test

stages:
  - lint
  - test

jobs:
  include:
    - stage: lint
      name: "Check linting with flake8"
      install: pip install -r requirements.dev.txt
      script: find . -name \*.py -exec flake8 {} +
      python: "3.7"
    - stage: lint
      name: "Check format with black"
      install: pip install -r requirements.dev.txt
      script: find . -name \*.py -exec black --quiet --diff {} +
      python: "3.7"
    - stage: test